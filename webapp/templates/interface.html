<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AutoGS</title>
	<link rel="icon" href="../static/images/autogs-icon.png">
	<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/style.css') }}">
	<link rel="stylesheet" href="../static/css/style.css">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Exo&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Exo:ital@0;1&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Exo:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
	<script type="text/javascript" src="../static/js/script.js"> </script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>

<script type="text/javascript">
	window.onload = function() {
		readSensor("temperature");
			readSensor("humidity");
			readSensor("soilmoisture");
			setInterval(loadSensors, 2.5 * 1000);
		}
			
	function loadSensors() {
		console.log("test");
		readSensor("temperature");
		readSensor("humidity");
		readSensor("soilmoisture");
	}

	function readSensor(sensor) {	
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
			    document.getElementById(sensor).innerHTML =  this.responseText;
			}
		};
		xhttp.open("GET", sensor, true);
		xhttp.send();
	}
</script>

<script type="text/javascript">
	function postRGBValues() {

		var redSlider = document.getElementById("red").value;
		var greenSlider = document.getElementById("green").value;
		var blueSlider = document.getElementById("blue").value;



		console.log(redSlider);
		console.log(greenSlider);
		console.log(blueSlider);

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
		
		if (this.readyState == 4 && this.status == 200) {
		document.getElementById("demo").innerHTML = this.responseText;
		}
	};

	xhttp.open("GET", "http://10.0.0.246:5000//changeRGB?red=" + String(redSlider) + "&green=" +String(greenSlider) + "&blue="+String(blueSlider), true);
	xhttp.send();
		document.getElementById("colour-changer").value = redSlider;
	}
</script>

<body>
	<div class="logo-home">
		<a href="interface.html">
		<img class="logo" src="../static/images/autogs-logo.png" alt="AutoGS">
		</a>
	</div>
	
	<div class="led">

		<div class="led-power">
			<p id="led-header">LED</p>
			<form action="#" method="POST">
				<button id="led-power-button" type="image" name="led-button" value="ledToggle" alt="LED Power"> 
					<img id="led-power" src="../static/images/power.png" alt="">
				</button>
			</form>
		</div>

		<div id="colour-box"></div>

		<div class="change-colour">
			<button id="change-colour-button" onclick="moveWaterDataDiv()">Change Colour</button>
		</div>

		<div id="colour-changer"class="colour-changer">
			<form id="rgbForm" action="#" method="POST">
				Red <input name="led-slider" type="range" min="0" max="255" step="1" id="red" value="255">
				Green <input name="led-slider" type="range" min="0" max="255" step="1" id="green" value="255">
				Blue <input name="led-slider" type="range" min="0" max="255" step="1" id="blue" value="255">
				<br>
				<input type="submit"name="sendRGB" onclick="postRGBValues();">
			</form>
		</div>
	</div>

	<script type="text/javascript"> // RGB slider display 
		var bgColour;
		var input = document.querySelectorAll("input");
			for(var i = 0; i < input.length; i++) {
			input[i].addEventListener("input", function() {
				var red = document.getElementById("red").value,
					green = document.getElementById("green").value,
					blue = document.getElementById("blue").value;
				var display = document.getElementById("colour-box");
				display.style.background = "rgb(" + red + ", " + green + ", " + blue + ")";
			});
		}

	</script>

	<br><br><br><br>

	<div id="waterDataDiv">

		<div class="water">

			<div class="water-text">
				<p id="water-text">Watering</p>
			</div>

			<div class="water-form">
				<form action="#" method="POST">

					<div class="water-buttons">
						<input onclick="disableManual();" name="wateroption" type="radio" id="automatic" value="AUTOMATIC">
						<label for="automatic">Automatic</label>			

						<label id="textbox-auto" for="autoWaterHumidityDrop" class="textbox">Water if humidity drops below: </label>
						<input class="water-textbox" type="text" id="autoWaterHumidityDrop">

						<br>

						<input onclick="disableAutomatic();" name="wateroption" type="radio" id="manual" value="MANUAL">
						<label for="manual">Manual</label>

						<label for="manualWaterTime" id="textbox-manual" class="textbox">Water for how many seconds:</label>
						<input class="water-textbox" type="text" id="manualWaterTime">

						<br>

						<div class="water-submit">
							<input id="water-submit" type="submit" name="waterSend">
						</div>
					</div>
				</form>
			</div>
		</div>

		<script type="text/javascript">	// radio button disable
			function disableManual() {
				document.getElementById("manualWaterTime").disabled = true;
				document.getElementById("autoWaterHumidityDrop").disabled = false;
				$('#'+localStorage.selected).trigger('click');
			}
			function disableAutomatic() {
				$('#'+localStorage.selected).trigger('click');
				document.getElementById("autoWaterHumidityDrop").disabled = true;
				document.getElementById("manualWaterTime").disabled = false;
			}

			window.onbeforeunload = function() {
				localStorage.setItem("auto", $('#textbox-auto').val());
				localStorage.setItem("manual", $('#textbox-manual').val());
			}

			window.onload = function() {
				var auto = localStorage.getItem("auto");
				if (auto !== null) $('#textbox-auto').val("auto");
				var manual = localStorage.getItem("manual");
				if (manual !== null) $('#textbox-manual').val("manual");
			}
		</script>

		<script type="text/javascript">	// disable textboxes onload
			var auto = document.getElementById("automatic");
			var autoTextbox = document.getElementById("autoWaterHumidityDrop");
			var manualTextbox = document.getElementById("manualWaterTime");

			window.onload = function() {
				if (auto.checked == true) {
					autoTextbox.disabled = false;
					manualTextbox.disabled = true;
				}
				else {
					autoTextbox.disabled = true;
					manualTextbox.disabled = false;
				}
			}
		</script>

		<script type="text/javascript"> // disable radio buttons onload
			$(document).ready(function() {
				var radioButtons = document.getElementsByName("wateroption");
				var val = localStorage.getItem('wateroption');

				for (var i = 0; i < radioButtons.length; i++) {
					if (radioButtons[i].value == val) {
						radioButtons[i].checked = true;
					}
				}
				$('input[name="wateroption"]').on('change', function() {
					localStorage.setItem('wateroption', $(this).val());
				
				});
			});
		</script>

		<div class="data">

			<div class="data-text">
				<p id="water-text">Data</p>
			</div>

			<div class="datalist">

				<div class="datalist-text">
					<span>Temperature =</span>
					<span id="temperature"></span>
				</div>		

				<div class="datalist-text">
					<span>Humidity =</span>
					<span id="humidity"></span>
				</div>			

				<div class="datalist-text">
					<span>Soil Moisture =</span>
					<span id="soilmoisture"></span>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript"> // RGB Slider disappear  on "Change Colour" button click

		const rgbSlider = document.getElementById("colour-changer");
		const button = document.getElementById("change-colour-button");
		const waterDataDiv = document.getElementById('waterDataDiv');
		var moveAmount = -5;

		button.onclick = function() {
			if (rgbSlider.style.display !== "block") {
				rgbSlider.style.display = "block";
				waterDataDiv.style.margin = "0";
			}
			else {
				rgbSlider.style.display = "none";
				waterDataDiv.style.margin = "-90px";
			}
		};
	</script>

</body>
</html>